import{d as L,b as u,c as p,w as a,e,a as t,L as z,I as f,M as j,N as H,h as r,O,K as _,P as G,j as B,f as s,Q as I,R as tt,r as m,J as k,T as et,U as at,G as st,V as nt,z as ot,W as lt,X as it,x as rt,H as ct,q as A,S as F,Y as J,C as dt,Z as ut,$ as pt,a0 as ft,a1 as K,a2 as _t,a3 as mt}from"./index-BV0GmIU9.js";import{_ as gt}from"./bcbplogo-DPdg0dlV.js";const yt="/bcbp-seeklogo.svg",vt=s("div",{class:"ion-padding"},[s("div",{class:"settings-content"},"Coming soon..")],-1),bt=L({__name:"SettingsModal",setup(g){const n=()=>I.dismiss(null,"cancel");return(i,c)=>(u(),p(t(B),{class:"settings-modal"},{default:a(()=>[e(t(z),null,{default:a(()=>[e(t(f),{icon:t(j),style:{"margin-left":"10px","margin-right":"-10px","font-size":"22px"},slot:"start"},null,8,["icon"]),e(t(H),null,{default:a(()=>[r("Settings")]),_:1}),e(t(O),{slot:"end"},{default:a(()=>[e(t(_),{color:"light",onClick:n},{default:a(()=>[e(t(f),{icon:t(G)},null,8,["icon"])]),_:1})]),_:1})]),_:1}),vt]),_:1}))}}),xt=s("div",{class:"ion-padding"},[s("div",{class:"update-library-content"},[s("div",{class:"indicator"},[s("div",null,"Updating library...")])])],-1),ht=L({__name:"UpdateLibraryModal",setup(g){return(n,i)=>(u(),p(t(B),null,{default:a(()=>[xt,e(t(tt),{type:"indeterminate",color:"success"})]),_:1}))}}),Ct=s("div",{class:"ion-padding",style:{color:"#555",display:"flex","flex-direction":"column",gap:"8px"}},[s("img",{src:gt,alt:"bcbp logo",height:"160",width:"160",style:{margin:"auto"}}),s("div",{style:{margin:"auto"}},[s("h4",null,"BCBP Hyms & Songs"),s("div",{style:{"font-size":"12px",color:"#777","margin-top":"10px"}},[s("span",null,"Version 1.2")]),s("div",{style:{"font-size":"12px",color:"#777","margin-top":"10px"}},[r(" Last library update: "),s("span",null,"04/08/2024")])])],-1),wt=L({__name:"AboutModal",setup(g){const n=()=>I.dismiss(null,"cancel");return(i,c)=>(u(),p(t(B),{class:"about-modal"},{default:a(()=>[e(t(z),null,{default:a(()=>[e(t(H),null,{default:a(()=>[r("About")]),_:1}),e(t(O),{slot:"end"},{default:a(()=>[e(t(_),{color:"light",onClick:n},{default:a(()=>[e(t(f),{icon:t(G)},null,8,["icon"])]),_:1})]),_:1})]),_:1}),Ct]),_:1}))}}),kt=L({__name:"MenuList",setup(g){const n=m(ct),i=m(A),c=m(!1),x=m(!1);(async()=>{const d=new F;await d.create();const o=await d.get("last-library-update");await J.get("api/last-update").then(l=>{o!=l.data.last_update?c.value=!0:x.value=!0})})();const y=async d=>{const o={component:wt,cssClass:"about-modal"},l={component:ht,cssClass:"update-library-modal"},v={component:bt,cssClass:"settings-modal"},W=await I.create(o),T=await I.create(l),X=await I.create(v);if(d=="settings"&&X.present(),d=="update"){T.present().then(async()=>{var C,w;i.value=new A(dt);const h=await i.value.checkConnectionsConsistency(),U=(await i.value.isConnection("db_songlist",!1)).result;h.result&&U?n.value=await((C=i.value)==null?void 0:C.retrieveConnection("db_songlist",!1)):n.value=await((w=i.value)==null?void 0:w.createConnection("db_songlist",!1,"no-encryption",1,!1)),Y()});const Y=async()=>{var V,E;const h=new F;await h.create();const U=await h.get("last-library-update");let C="Library is already up to date";await((V=n.value)==null?void 0:V.open());const w=await((E=n.value)==null?void 0:E.query("SELECT COUNT(*) as song_count FROM songs"));console.log("res: ".concat(JSON.stringify(w.values[0].song_count))),await J.get("/api/songs").then(M=>{var Q,q;const N=M.data.data,P=M.data.last_update;if(U!=P||parseInt(w.values[0].song_count)!==parseInt(N.length)){let $=null;(Q=n.value)==null||Q.query("DELETE FROM songs"),N.forEach(b=>{var R;try{$=P,(R=n.value)==null||R.query("INSERT INTO songs (id,title,lyrics,chords,artist,category) values (?,?,?,?,?,?)",[b.id,b.title,b.lyrics,b.chords,b.artist,b.category]),C="Library has been updated"}catch(Z){$=null,alert(Z)}}),h.set("last-library-update",$),x.value=!0,(q=n.value)==null||q.close()}}),T.dismiss();const D=await ut.create({message:C,duration:3e3,cssClass:"custom-toast",position:"bottom"});D.present(),D.onDidDismiss().then(M=>{M.role&&window.location.reload()})}}d=="about"&&W.present()};return(d,o)=>(u(),p(t(B),null,{default:a(()=>[e(t(rt),{lines:"full"},{default:a(()=>[e(t(k),{button:"",onClick:o[0]||(o[0]=l=>y("settings"))},{default:a(()=>[e(t(_),{fill:"clear",expand:"block",style:{color:"#777","text-transform":"capitalize","font-size":"14px",padding:"10px 0"}},{default:a(()=>[e(t(f),{slot:"start",icon:t(j)},null,8,["icon"]),r(" Settings ")]),_:1})]),_:1}),c.value?(u(),p(t(k),{key:0,button:"",onClick:o[1]||(o[1]=l=>y("update"))},{default:a(()=>[e(t(_),{fill:"clear",expand:"block",style:{color:"#777","text-transform":"capitalize","font-size":"14px",padding:"10px 0"}},{default:a(()=>[e(t(f),{slot:"start",icon:t(et)},null,8,["icon"]),r(" Download Update ")]),_:1}),c.value?(u(),p(t(at),{key:0,color:"success"},{default:a(()=>[r("new")]),_:1})):st("",!0)]),_:1})):x.value?(u(),p(t(k),{key:2},{default:a(()=>[e(t(_),{fill:"clear",expand:"block",style:{color:"#777","text-transform":"capitalize","font-size":"14px",padding:"10px 0"}},{default:a(()=>[e(t(f),{slot:"start",icon:t(lt)},null,8,["icon"]),r("Library is up to date")]),_:1})]),_:1})):(u(),p(t(k),{key:1},{default:a(()=>[e(t(nt),{name:"lines-sharp-small"}),e(t(ot),{style:{color:"#777","font-size":"14px",padding:"10px 0"}},{default:a(()=>[r("Checking for updates")]),_:1})]),_:1})),e(t(k),{lines:"none",button:"",onClick:o[2]||(o[2]=l=>y("about"))},{default:a(()=>[e(t(_),{fill:"clear",expand:"block",style:{color:"#777","text-transform":"capitalize","font-size":"14px",padding:"10px 0"}},{default:a(()=>[e(t(f),{slot:"start",icon:t(it)},null,8,["icon"]),r(" About ")]),_:1})]),_:1})]),_:1})]),_:1}))}}),It=s("img",{src:yt,height:"40",slot:"start",style:{"margin-left":"14px","margin-right":"-10px"}},null,-1),Mt=L({__name:"HeaderToolBar",props:{isHeaderHidden:{type:Boolean,default:!1}},emits:["emitSearch"],setup(g,{emit:n}){const i=n,c=m(""),x=()=>{i("emitSearch",{searchQuery:c.value})},S=m(!1),y=m(),d=o=>{y.value=o,S.value=!0};return(o,l)=>(u(),p(t(mt),{class:"ion-no-border"},{default:a(()=>[e(t(z),{class:K(["header-transition",{"ion-header-hidden":g.isHeaderHidden}])},{default:a(()=>[It,e(t(H),null,{default:a(()=>[r("BCBP Hymns & Songs")]),_:1}),e(t(O),{slot:"primary"},{default:a(()=>[e(t(_),{onClick:l[0]||(l[0]=v=>d(v))},{default:a(()=>[e(t(f),{slot:"icon-only",icon:t(pt)},null,8,["icon"])]),_:1}),e(t(ft),{"is-open":S.value,event:y.value,onDidDismiss:l[1]||(l[1]=v=>S.value=!1)},{default:a(()=>[e(kt)]),_:1},8,["is-open","event"])]),_:1})]),_:1},8,["class"]),e(t(z),{class:K(["header-transition",{"search-bar-persist":g.isHeaderHidden}])},{default:a(()=>[e(t(_t),{"show-clear-button":"focus",class:"searchbar",id:"searchbar",modelValue:c.value,"onUpdate:modelValue":l[2]||(l[2]=v=>c.value=v),onKeyup:x},null,8,["modelValue"])]),_:1},8,["class"])]),_:1}))}});export{Mt as _};
